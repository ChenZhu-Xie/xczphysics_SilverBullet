
1. https://community.silverbullet.md/t/fixing-silver-bullets-chinese-search-gap-a-space-lua-global-search-implementation/3157

```space-lua
-- 1. å·¥å…·å‡½æ•°ï¼šè½¬ä¹‰ Lua æ­£åˆ™ç‰¹æ®Šå­—ç¬¦ (ä¼˜åŒ–ç‰ˆ)
local function escapeLuaPattern(s)
    -- Lua çš„ç‰¹æ®Šå­—ç¬¦åŒ…æ‹¬: ^ $ ( ) % . [ ] * + - ?
    -- æ³¨æ„ï¼šLua ä½¿ç”¨ % ä½œä¸ºè½¬ä¹‰ç¬¦ï¼Œè€Œä¸æ˜¯ \
    local matches = {
        ["^"] = "%^", ["$"] = "%$", ["("] = "%(", [")"] = "%)",
        ["%"] = "%%", ["."] = "%." , ["["] = "%[", ["]"] = "%]",
        ["*"] = "%*", ["+"] = "%+", ["-"] = "%-", ["?"] = "%?"
    }
    return string.gsub(s, ".", matches)
end

-- 2. å®šä¹‰è™šæ‹Ÿé¡µé¢ï¼šsearch:å…³é”®è¯
virtualPage.define {
    pattern = "search:(.+)",
    run = function(keyword)
        -- è§£ç å…³é”®è¯ï¼ˆå¤„ç† URL ç¼–ç ç­‰æƒ…å†µï¼‰å¹¶å»ç©º
        keyword = keyword:trim()
        if keyword == "" then 
            return "âš ï¸ **Error**: Please provide a search keyword." 
        end

        local output = {} -- ä½¿ç”¨ table ä½œä¸º Bufferï¼Œæ€§èƒ½ä¼˜äºå­—ç¬¦ä¸²æ‹¼æ¥
        
        -- é¡µé¢å¤´éƒ¨
        table.insert(output, "# ğŸ” Search Results for: **" .. keyword .. "**")
        table.insert(output, "---")

        local pages = space.listPages()
        local escapedKeyword = escapeLuaPattern(keyword)
        
        -- æ„å»ºæ­£åˆ™ï¼šæ•è· (å‰15å­—ç¬¦)(å…³é”®è¯)(å15å­—ç¬¦)
        -- ä½¿ç”¨ () æ•è·ç»„æ˜¯ä¸ºäº†æ–¹ä¾¿åç»­åŠ ç²—å…³é”®è¯
        local pattern = "(.{0,15})(" .. escapedKeyword .. ")(.{0,15})"

        local matchCount = 0

        for _, page in ipairs(pages) do
            -- æ’é™¤è‡ªèº«ï¼Œé˜²æ­¢æ­»å¾ªç¯
            if not string.find(page.name, "^search:") then
                local content = space.readPage(page.name)
                
                -- ã€æ ¸å¿ƒä¼˜åŒ–ã€‘å…ˆè¿›è¡Œçº¯æ–‡æœ¬å¿«é€Ÿæ£€æŸ¥ (plain=true)
                -- åªæœ‰å½“é¡µé¢ç¡®å®åŒ…å«å…³é”®è¯æ—¶ï¼Œæ‰è¿è¡Œæ˜‚è´µçš„æ­£åˆ™æå–
                if string.find(content, keyword, 1, true) then
                    local pageMatches = {}
                    
                    -- æå–ä¸Šä¸‹æ–‡å¹¶é«˜äº®
                    for prefix, match, suffix in string.gmatch(content, pattern) do
                        -- æ›¿æ¢æ¢è¡Œç¬¦ï¼Œé˜²æ­¢ç ´ååˆ—è¡¨æ ¼å¼
                        local cleanPrefix = prefix:gsub("\n", " ")
                        local cleanSuffix = suffix:gsub("\n", " ")
                        
                        -- æ„å»ºé«˜äº®å­—ç¬¦ä¸²: ...å‰æ–‡==å…³é”®è¯==åæ–‡...
                        local formatted = string.format("%s==%s==%s", cleanPrefix, match, cleanSuffix)
                        table.insert(pageMatches, formatted)
                    end

                    -- åªæœ‰å½“æ­£åˆ™ä¹ŸæˆåŠŸåŒ¹é…åˆ°å†…å®¹æ—¶æ‰è¾“å‡ºï¼ˆåŒé‡ä¿é™©ï¼‰
                    if #pageMatches > 0 then
                        matchCount = matchCount + 1
                        -- é¡µé¢æ ‡é¢˜é“¾æ¥
                        table.insert(output, "### [[" .. page.name .. "]]")
                        -- åŒ¹é…é¡¹åˆ—è¡¨
                        for _, m in ipairs(pageMatches) do
                            table.insert(output, "* " .. m)
                        end
                        table.insert(output, "") -- ç©ºè¡Œåˆ†éš”
                    end
                end
            end
        end

        if matchCount == 0 then
            return "No results found for **" .. keyword .. "**."
        end

        return table.concat(output, "\n")
    end
}

-- 3. å®šä¹‰å‘½ä»¤ï¼šå”¤èµ·æœç´¢
command.define {
    name = "Global Search",
    key = "Ctrl-Alt-f", -- ç»‘å®šå¿«æ·é”®
    run = function()
        local keyword = editor.prompt("ğŸ” Global Search Keyword:")
        if keyword and keyword ~= "" then
            -- ç›´æ¥å¯¼èˆªåˆ°è™šæ‹Ÿé¡µé¢ï¼Œç”± SilverBullet è´Ÿè´£æ¸²æŸ“ Markdown
            editor.navigate("search:" .. keyword)
        end
    end
}

```